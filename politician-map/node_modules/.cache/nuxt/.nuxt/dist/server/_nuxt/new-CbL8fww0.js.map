{"version":3,"file":"new-CbL8fww0.js","sources":["../../../../../../../pages/suggestions/new.vue"],"sourcesContent":["<template>\n  <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n    <div class=\"mb-8\">\n      <h1 class=\"text-3xl font-bold text-gray-900 mb-2\">건의사항 작성</h1>\n      <p class=\"text-gray-600\">정치인에게 전달할 건의사항을 작성해주세요</p>\n    </div>\n\n    <form @submit.prevent=\"handleSubmit\" class=\"bg-white border border-gray-200 p-8\">\n      <!-- 정치인 선택 -->\n      <div class=\"mb-6\">\n        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n          정치인 선택 *\n        </label>\n        <select\n          v-model=\"form.politician_id\"\n          required\n          class=\"w-full px-4 py-3 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        >\n          <option value=\"\">정치인을 선택하세요</option>\n          <option\n            v-for=\"politician in politicians\"\n            :key=\"politician.id\"\n            :value=\"politician.id\"\n          >\n            {{ politician.의원명 }} ({{ politician.지역 }}, {{ politician.정당 }})\n          </option>\n        </select>\n      </div>\n\n      <!-- 카테고리 -->\n      <div class=\"mb-6\">\n        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n          카테고리 *\n        </label>\n        <select\n          v-model=\"form.category\"\n          required\n          class=\"w-full px-4 py-3 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        >\n          <option value=\"\">카테고리를 선택하세요</option>\n          <option value=\"경제\">경제</option>\n          <option value=\"교육\">교육</option>\n          <option value=\"환경\">환경</option>\n          <option value=\"복지\">복지</option>\n          <option value=\"안전\">안전</option>\n          <option value=\"교통\">교통</option>\n          <option value=\"문화\">문화</option>\n          <option value=\"기타\">기타</option>\n        </select>\n      </div>\n\n      <!-- 제목 -->\n      <div class=\"mb-6\">\n        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n          제목 *\n        </label>\n        <input\n          v-model=\"form.title\"\n          type=\"text\"\n          required\n          maxlength=\"100\"\n          placeholder=\"건의사항 제목을 입력하세요\"\n          class=\"w-full px-4 py-3 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        />\n        <p class=\"mt-1 text-sm text-gray-500\">{{ form.title.length }}/100</p>\n      </div>\n\n      <!-- 내용 -->\n      <div class=\"mb-6\">\n        <label class=\"block text-sm font-semibold text-gray-700 mb-2\">\n          내용 *\n        </label>\n        <textarea\n          v-model=\"form.content\"\n          required\n          rows=\"10\"\n          maxlength=\"2000\"\n          placeholder=\"건의사항 내용을 상세히 작성해주세요\"\n          class=\"w-full px-4 py-3 border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none\"\n        ></textarea>\n        <p class=\"mt-1 text-sm text-gray-500\">{{ form.content.length }}/2000</p>\n      </div>\n\n      <!-- 에러 메시지 -->\n      <div v-if=\"error\" class=\"mb-6 p-4 bg-red-50 border border-red-200\">\n        <p class=\"text-red-700\">{{ error }}</p>\n      </div>\n\n      <!-- 버튼 -->\n      <div class=\"flex gap-4\">\n        <button\n          type=\"submit\"\n          :disabled=\"submitting\"\n          class=\"flex-1 px-6 py-3 bg-gray-800 text-white font-semibold hover:bg-gray-900 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed\"\n        >\n          {{ submitting ? '작성 중...' : '작성 완료' }}\n        </button>\n        <button\n          type=\"button\"\n          @click=\"router.back()\"\n          class=\"px-6 py-3 bg-gray-200 text-gray-700 font-semibold hover:bg-gray-300 transition-colors\"\n        >\n          취소\n        </button>\n      </div>\n    </form>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, onMounted, onActivated } from 'vue'\n\ndefinePageMeta({\n  middleware: 'auth',\n  layout: 'default'\n})\n\nconst router = useRouter()\nconst route = useRoute()\nconst { politicians, loadPoliticians } = usePoliticians()\nconst { createSuggestion } = useSuggestions()\n\nconst form = ref({\n  politician_id: '',\n  category: '',\n  title: '',\n  content: ''\n})\n\nconst submitting = ref(false)\nconst error = ref('')\n\n// New function to reset the form and submitting state\nfunction resetForm() {\n  form.value = {\n    politician_id: route.query.politician_id as string || '', // Re-apply from query if present\n    category: '',\n    title: '',\n    content: ''\n  }\n  submitting.value = false\n  error.value = '' // Also clear any previous errors\n}\n\nonMounted(async () => {\n  await loadPoliticians()\n  resetForm() // Ensure clean state on initial mount\n})\n\n// Add onActivated hook for potential component reuse\nonActivated(() => {\n  resetForm() // Ensure clean state when component is re-activated (e.g., via keep-alive)\n})\n\n// Watch route changes to ensure reset when navigating back to this specific page\nwatch(() => route.fullPath, (newPath) => {\n  if (newPath === '/suggestions/new') {\n    resetForm() // Ensure a full reset when navigating specifically to this page\n  }\n}, { immediate: true })\n\nasync function handleSubmit() {\n  if (submitting.value) return\n\n  error.value = ''\n  submitting.value = true\n\n  try {\n    const { data, error: submitError } = await createSuggestion({\n      title: form.value.title,\n      content: form.value.content,\n      category: form.value.category,\n      politician_id: parseInt(form.value.politician_id)\n    })\n\n    if (submitError) {\n      error.value = submitError\n      return\n    }\n\n    if (data) {\n      resetForm() // Explicitly reset on success before navigation\n      router.push(`/suggestions/${data.id}`)\n    }\n  } catch (err: any) {\n    error.value = err.message || '건의사항 작성 중 오류가 발생했습니다'\n  } finally {\n    // 버튼이 다시 활성화되도록 보장합니다. 특히 에러가 발생한 경우.\n    // (submitting.value가 현재 true인 경우에만 false로 설정)\n    if (submitting.value === true) {\n      submitting.value = false\n    }\n  }\n}\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrIncludeBooleanAttr","_ssrLooseContain","_ssrLooseEqual","_ssrRenderList","_unref","_ssrInterpolate","_ssrRenderAttr"],"mappings":"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"}