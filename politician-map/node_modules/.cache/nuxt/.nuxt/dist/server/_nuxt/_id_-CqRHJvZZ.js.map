{"version":3,"file":"_id_-CqRHJvZZ.js","sources":["../../../../../../../composables/useComments.ts","../../../../../../../pages/suggestions/[id].vue"],"sourcesContent":["export function useComments(suggestionId: number) {\n  const supabase = useSupabaseClient()\n  const comments = ref<any[]>([])\n  const loading = ref(false)\n\n  // 댓글 목록 조회\n  const loadComments = async () => {\n    loading.value = true\n    try {\n      // 1. Fetch comments without profiles join\n      const { data: commentData, error: commentError } = await supabase\n        .from('comments')\n        .select(`\n          *,\n          parent_id\n        `)\n        .eq('suggestion_id', suggestionId)\n        .order('created_at', { ascending: true })\n\n      if (commentError) throw commentError;\n      if (!commentData) {\n        comments.value = [];\n        return { data: [], error: null };\n      }\n\n      // 2. Extract unique user IDs\n      const userIds = [...new Set(commentData.map(c => c.user_id))];\n\n      // 3. Fetch profiles for these users\n      const { data: profilesData, error: profilesError } = await supabase\n        .from('profiles')\n        .select('id, nickname')\n        .in('id', userIds);\n\n      if (profilesError) {\n        console.error('Failed to fetch profiles for comments:', profilesError);\n      }\n\n      // 4. Create a map for quick profile lookup\n      const profilesMap = new Map(profilesData?.map(p => [p.id, p]));\n\n      // 5. Combine comments with their profiles\n      const combinedComments = commentData.map(comment => ({\n        ...comment,\n        profiles: profilesMap.get(comment.user_id) || null\n      }));\n\n      comments.value = combinedComments;\n      return { data: combinedComments, error: null }\n    } catch (error: any) {\n      console.error('Failed to load comments:', error)\n      return { data: null, error: error.message }\n    } finally {\n      loading.value = false\n    }\n  }\n\n  // 댓글 작성\n  const createComment = async (content: string, parentId: number | null = null) => {\n    try {\n      const user = useSupabaseUser()\n      if (!user.value) {\n        throw new Error('로그인이 필요합니다')\n      }\n\n      // Supabase user 객체에서 ID는 id 또는 sub 필드에 있을 수 있음\n      const userId = user.value.id || user.value.sub\n\n      // 1. Insert the comment and get its ID\n      const { data: newCommentId, error: insertError } = await supabase\n        .from('comments')\n        .insert([{\n          content,\n          suggestion_id: suggestionId,\n          user_id: userId,\n          parent_id: parentId // Add parent_id here\n        }])\n        .select('id')\n        .single()\n\n      if (insertError) throw insertError\n      if (!newCommentId) throw new Error('Failed to get new comment ID')\n\n      // 2. Fetch the newly created comment\n      const { data: newCommentData, error: fetchCommentError } = await supabase\n        .from('comments')\n        .select('*')\n        .eq('id', newCommentId.id)\n        .single()\n\n      if (fetchCommentError) throw fetchCommentError\n      if (!newCommentData) throw new Error('Failed to fetch new comment data')\n\n      // 3. Fetch the profile for the new comment's user\n      const { data: profileData, error: profileError } = await supabase\n        .from('profiles')\n        .select('id, nickname')\n        .eq('id', newCommentData.user_id)\n        .single()\n\n      if (profileError) {\n        console.error('Failed to fetch profile for new comment:', profileError)\n      }\n\n      // 4. Combine the data\n      const combinedNewComment = {\n        ...newCommentData,\n        profiles: profileData || null\n      }\n\n      // 댓글 목록에 추가\n      comments.value.push(combinedNewComment)\n\n      return { data: combinedNewComment, error: null }\n    } catch (error: any) {\n      console.error('Failed to create comment:', error)\n      return { data: null, error: error.message }\n    }\n  }\n\n  // 댓글 수정\n  const updateComment = async (id: number, content: string) => {\n    try {\n      // 1. Update the comment content\n      const { data: updatedCommentResult, error: updateError } = await supabase\n        .from('comments')\n        .update({ content })\n        .eq('id', id)\n        .select('*') // Select only the updated comment data\n        .single()\n\n      if (updateError) throw updateError\n      if (!updatedCommentResult) throw new Error('Failed to update comment or get updated data')\n\n      // 2. Fetch the profile for the updated comment's user\n      const { data: profileData, error: profileError } = await supabase\n        .from('profiles')\n        .select('id, nickname')\n        .eq('id', updatedCommentResult.user_id)\n        .single()\n\n      if (profileError) {\n        console.error('Failed to fetch profile for updated comment:', profileError)\n      }\n\n      // 3. Combine the data\n      const combinedUpdatedComment = {\n        ...updatedCommentResult,\n        profiles: profileData || null\n      }\n\n      // 댓글 목록 업데이트\n      const index = comments.value.findIndex(c => c.id === id)\n      if (index !== -1) {\n        comments.value[index] = combinedUpdatedComment\n      }\n\n      return { data: combinedUpdatedComment, error: null }\n    } catch (error: any) {\n      console.error('Failed to update comment:', error)\n      return { data: null, error: error.message }\n    }\n  }\n\n  // 댓글 삭제\n  const deleteComment = async (id: number) => {\n    try {\n      const { error } = await supabase\n        .from('comments')\n        .delete()\n        .eq('id', id)\n\n      if (error) throw error\n\n      // 댓글 목록에서 제거\n      comments.value = comments.value.filter(c => c.id !== id)\n\n      return { error: null }\n    } catch (error: any) {\n      console.error('Failed to delete comment:', error)\n      return { error: error.message }\n    }\n  }\n\n  return {\n    comments,\n    loading,\n    loadComments,\n    createComment,\n    updateComment,\n    deleteComment\n  }\n}\n","<template>\n  <div class=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n    <!-- 로딩 상태 -->\n    <div v-if=\"loading\" class=\"text-center py-16\">\n      <div class=\"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-gray-800\"></div>\n    </div>\n\n    <!-- 에러 상태 -->\n    <div v-else-if=\"error\" class=\"text-center py-16\">\n      <p class=\"text-red-600 text-lg mb-4\">{{ error }}</p>\n      <button\n        @click=\"router.back()\"\n        class=\"px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors\"\n      >\n        돌아가기\n      </button>\n    </div>\n\n    <!-- 건의사항 상세 -->\n    <div v-else-if=\"suggestion\">\n      <!-- 헤더 -->\n      <div class=\"mb-6\">\n        <div class=\"flex items-center justify-between mb-4\">\n          <button\n            @click=\"router.back()\"\n            class=\"text-gray-600 hover:text-gray-900 font-medium\"\n          >\n            ← 목록으로\n          </button>\n          <div v-if=\"isOwner\" class=\"flex gap-2\">\n            <button\n              @click=\"handleEdit\"\n              class=\"px-4 py-2 bg-gray-800 text-white rounded-lg font-medium hover:bg-gray-900 transition-colors\"\n            >\n              수정\n            </button>\n            <button\n              @click=\"handleDelete\"\n              class=\"px-4 py-2 bg-red-600 text-white rounded-lg font-medium hover:bg-red-700 transition-colors\"\n            >\n              삭제\n            </button>\n          </div>\n        </div>\n      </div>\n\n      <!-- 건의사항 본문 -->\n      <div class=\"bg-white border border-gray-200 rounded-lg p-8 mb-6\">\n        <div class=\"mb-4\">\n          <span class=\"px-3 py-1 bg-gray-50 text-gray-700 rounded-full text-sm font-medium\">\n            {{ suggestion.category }}\n          </span>\n        </div>\n\n        <h1 class=\"text-3xl font-bold text-gray-900 mb-6\">\n          {{ suggestion.title }}\n        </h1>\n\n        <div class=\"flex items-center justify-between text-sm text-gray-500 mb-8 pb-6 border-b border-gray-200\">\n          <div class=\"flex items-center space-x-4\">\n            <span class=\"font-medium text-gray-700\">{{ suggestion.profiles?.nickname || '익명' }}</span>\n            <span>→</span>\n            <NuxtLink\n              :to=\"`/politicians/${suggestion.politician_id}/suggestions`\"\n              class=\"font-medium text-gray-800 hover:text-blue-800\"\n            >\n              {{ suggestion.politicians?.name }}\n            </NuxtLink>\n            <span>({{ suggestion.politicians?.region }})</span>\n          </div>\n          <div class=\"flex items-center space-x-4\">\n            <span>조회 {{ suggestion.view_count || 0 }}</span>\n            <span>{{ formatDate(suggestion.created_at) }}</span>\n          </div>\n        </div>\n\n        <div class=\"prose max-w-none\">\n          <p class=\"text-gray-800 whitespace-pre-wrap leading-relaxed\">{{ suggestion.content }}</p>\n        </div>\n      </div>\n\n      <!-- 댓글 섹션 -->\n      <div class=\"bg-white border border-gray-200 rounded-lg p-8\">\n        <h2 class=\"text-2xl font-bold text-gray-900 mb-6\">\n          댓글 {{ comments.length }}\n        </h2>\n\n\n\n        <!-- New Top-Level Comment Input -->\n        <div v-if=\"isAuthenticated\" class=\"mb-8\">\n          <textarea\n            v-model=\"newComment\"\n            rows=\"3\"\n            placeholder=\"새 댓글을 작성하세요\"\n            class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none mb-2\"\n          ></textarea>\n          <div class=\"flex justify-end\">\n            <button\n              @click=\"handleCreateComment(null)\"\n              :disabled=\"!newComment.trim() || commentSubmitting\"\n              class=\"px-6 py-2 bg-gray-800 text-white rounded-lg font-medium hover:bg-gray-900 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed\"\n            >\n              댓글 작성\n            </button>\n          </div>\n        </div>\n\n        <div v-else class=\"mb-8 p-4 bg-gray-50 rounded-lg text-center\">\n          <p class=\"text-gray-600 mb-2\">댓글을 작성하려면 로그인이 필요합니다</p>\n          <NuxtLink\n            to=\"/auth/login\"\n            class=\"text-gray-800 hover:text-blue-800 font-medium\"\n          >\n            로그인하기 →\n          </NuxtLink>\n        </div>\n\n        <!-- 댓글 목록 -->\n        <div class=\"space-y-4\">\n          <template v-if=\"comments.length > 0\">\n            <div\n              v-for=\"comment in threadedComments\"\n              :key=\"comment.id\"\n              class=\"border-b border-gray-200 pb-4 last:border-0\"\n            >\n                            <div> <!-- NEW WRAPPING DIV START -->\n                              <!-- Parent Comment -->\n                              <div>\n                                <div class=\"flex justify-between items-start mb-2\">\n                                  <div class=\"flex items-center space-x-3\">\n                                    <span class=\"font-medium text-gray-900\">{{ getCommentNickname(comment) }}</span>\n                                    <span class=\"text-sm text-gray-500\">{{ formatDate(comment.created_at) }}</span>\n                                  </div>\n                                  <div class=\"flex gap-2\">\n                                    <button\n                                      v-if=\"isAuthenticated\"\n                                      @click=\"replyToComment(comment)\"\n                                      class=\"text-sm text-gray-600 hover:text-blue-700\"\n                                    >\n                                      답글\n                                    </button>\n                                    <template v-if=\"user && (user.id || user.sub) === comment.user_id\">\n                                      <button\n                                        @click=\"handleEditComment(comment)\"\n                                        class=\"text-sm text-gray-800 hover:text-blue-800\"\n                                      >\n                                        수정\n                                      </button>\n                                      <button\n                                        @click=\"handleDeleteComment(comment.id)\"\n                                        class=\"text-sm text-red-600 hover:text-red-800\"\n                                      >\n                                      삭제\n                                      </button>\n                                    </template>\n                                  </div>\n                                </div>\n              \n                                <div v-if=\"editingCommentId === comment.id\">\n                                  <textarea\n                                    v-model=\"editingCommentContent\"\n                                    rows=\"3\"\n                                    class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none mb-2\"\n                                  ></textarea>\n                                  <div class=\"flex justify-end gap-2\">\n                                    <button\n                                      @click=\"handleUpdateComment(comment.id)\"\n                                      class=\"px-4 py-2 bg-gray-800 text-white rounded-lg text-sm font-medium hover:bg-gray-900\"\n                                    >\n                                      저장\n                                    </button>\n                                    <button\n                                      @click=\"cancelEditComment\"\n                                      class=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300\"\n                                    >\n                                      취소\n                                    </button>\n                                  </div>\n                                </div>\n                                <p v-else class=\"text-gray-700 whitespace-pre-wrap\">{{ comment.content }}</p>\n              \n                                <!-- REPLY INPUT FORM FOR TOP-LEVEL COMMENT -->\n                                <div v-if=\"isAuthenticated && replyingToCommentId === comment.id\" class=\"mt-4\">\n                                  <textarea\n                                    v-model=\"newReplyContent\"\n                                    rows=\"3\"\n                                    placeholder=\"답글을 작성하세요\"\n                                    class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none mb-2\"\n                                  ></textarea>\n                                  <div class=\"flex justify-end gap-2\">\n                                    <button\n                                      @click=\"handleCreateComment(comment.id)\"\n                                      :disabled=\"!newReplyContent.trim() || commentSubmitting\"\n                                      class=\"px-6 py-2 bg-gray-800 text-white rounded-lg font-medium hover:bg-gray-900 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed\"\n                                    >\n                                      답글 작성\n                                    </button>\n                                    <button\n                                      @click=\"cancelReply\"\n                                      class=\"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300\"\n                                    >\n                                      취소\n                                    </button>\n                                  </div>\n                                </div>\n                              </div>\n              \n              \n                              <!-- Replies -->\n                              <div\n                                v-if=\"comment.replies && comment.replies.length > 0\"\n                                class=\"ml-8 mt-4 space-y-4 border-t border-gray-200 pt-4\"\n                              >\n                                <div\n                                  v-for=\"reply in comment.replies\"\n                                  :key=\"reply.id\"\n                                >\n                                  <div class=\"flex justify-between items-start mb-2\">\n                                    <div class=\"flex items-center space-x-3\">\n                                      <span class=\"font-medium text-gray-900\">{{ getCommentNickname(reply) }}</span>\n                                      <span class=\"text-sm text-gray-500\">{{ formatDate(reply.created_at) }}</span>\n                                    </div>\n                                                        <div class=\"flex gap-2\">\n                                                          <template v-if=\"user && (user.id || user.sub) === reply.user_id\">\n                                                            <button\n                                                              @click=\"handleEditComment(reply)\"\n                                                              class=\"text-sm text-gray-800 hover:text-blue-800\"\n                                                            >\n                                                              수정\n                                                            </button>\n                                                            <button\n                                                              @click=\"handleDeleteComment(reply.id)\"\n                                                              class=\"text-sm text-red-600 hover:text-red-800\"\n                                                            >\n                                                              삭제\n                                                            </button>\n                                                          </template>\n                                                        </div>                                  </div>\n              \n                                  <div v-if=\"editingCommentId === reply.id\">\n                                    <textarea\n                                      v-model=\"editingCommentContent\"\n                                      rows=\"3\"\n                                      class=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none mb-2\"\n                                    ></textarea>\n                                    <div class=\"flex justify-end gap-2\">\n                                      <button\n                                        @click=\"handleUpdateComment(reply.id)\"\n                                        class=\"px-4 py-2 bg-gray-800 text-white rounded-lg text-sm font-medium hover:bg-gray-900\"\n                                      >\n                                        저장\n                                      </button>\n                                      <button\n                                        @click=\"cancelEditComment\"\n                                        class=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-300\"\n                                      >\n                                        취소\n                                      </button>\n                                    </div>\n                                  </div>\n                                  <p v-else class=\"text-gray-700 whitespace-pre-wrap\">{{ reply.content }}</p>\n              \n                                                                  </div>\n                              </div>\n                            </div> <!-- NEW WRAPPING DIV END -->\n            </div>\n          </template>\n\n          <div v-else class=\"text-center py-8 text-gray-500\">\n            아직 댓글이 없습니다. 첫 댓글을 작성해보세요!\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from 'vue'\n\ndefinePageMeta({\n  layout: 'default'\n})\n\nconst route = useRoute()\nconst router = useRouter()\nconst { user, isAuthenticated } = useAuth()\nconst { getSuggestion, deleteSuggestion } = useSuggestions()\n\nconst suggestionId = parseInt(route.params.id as string)\nconst { comments, loadComments, createComment, updateComment, deleteComment } = useComments(suggestionId)\n\nconst suggestion = ref(null)\nconst loading = ref(true)\nconst error = ref('')\n\nconst newComment = ref('')\nconst commentSubmitting = ref(false)\n\nconst editingCommentId = ref<number | null>(null)\nconst editingCommentContent = ref('')\n\nconst replyingToCommentId = ref<number | null>(null)\nconst newReplyContent = ref('')\nconst replyingToNickname = ref<string | null>(null)\n\nconst isOwner = computed(() => {\n  const userId = user.value?.id || user.value?.sub\n  return user.value && suggestion.value && userId === suggestion.value.user_id\n})\n\n// Helper to get nickname from comment or profile\nconst getCommentNickname = (comment: any) => {\n  return comment.profiles?.nickname || '익명'\n}\n\nconst threadedComments = computed(() => {\n  const topLevelComments = comments.value.filter(comment => !comment.parent_id);\n  const replies = comments.value.filter(comment => comment.parent_id);\n\n  const commentsMap = new Map(comments.value.map(comment => [comment.id, { ...comment, replies: [] }]));\n\n  replies.forEach(reply => {\n    const parent = commentsMap.get(reply.parent_id);\n    if (parent) {\n      parent.replies.push(reply);\n    }\n  });\n\n  // Sort top-level comments by creation date\n  topLevelComments.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n\n  // Sort replies for each top-level comment by creation date\n  commentsMap.forEach(comment => {\n    if (comment.replies) {\n      comment.replies.sort((a, b) => new Date(a.created_at).getTime() - new Date(b.created_at).getTime());\n    }\n  });\n\n  // Only return top-level comments with their direct replies\n  // This structure currently supports one level of nesting (original comment + direct replies)\n  return topLevelComments.map(comment => commentsMap.get(comment.id));\n})\n\n\nonMounted(async () => {\n  await loadSuggestion()\n  await loadComments()\n})\n\nasync function loadSuggestion() {\n  loading.value = true\n  error.value = ''\n\n  const { data, error: loadError } = await getSuggestion(suggestionId)\n\n  if (loadError) {\n    error.value = loadError\n  } else {\n    suggestion.value = data\n  }\n\n  loading.value = false\n}\n\nasync function handleCreateComment(parentId: number | null = null) {\n  let content = '';\n  if (parentId === null) { // This is a top-level comment\n    content = newComment.value;\n  } else { // This is an inline reply\n    content = newReplyContent.value;\n  }\n\n  if (!content.trim() || commentSubmitting.value) return;\n\n  commentSubmitting.value = true;\n\n  const { error: createError } = await createComment(content, parentId);\n\n  if (createError) {\n    alert('댓글 작성에 실패했습니다: ' + createError);\n  } else {\n    if (parentId === null) { // Clear top-level comment input\n      newComment.value = '';\n    } else { // Clear inline reply input\n      newReplyContent.value = '';\n    }\n    cancelReply(); // Clear reply state (replyingToCommentId) after successful comment\n    await loadComments();\n  }\n\n  commentSubmitting.value = false;\n}\n\nfunction handleEditComment(comment: any) {\n  editingCommentId.value = comment.id\n  editingCommentContent.value = comment.content\n  cancelReply() // Exit reply mode when editing\n}\n\nfunction cancelEditComment() {\n  editingCommentId.value = null\n  editingCommentContent.value = ''\n}\n\nfunction cancelReply() {\n  replyingToCommentId.value = null\n  newReplyContent.value = '' // Clear the reply input content\n  replyingToNickname.value = null\n}\n\nfunction replyToComment(comment: any) {\n  replyingToCommentId.value = comment.id\n  replyingToNickname.value = getCommentNickname(comment)\n  cancelEditComment() // Exit edit mode when replying\n}\n\nasync function handleEdit() {\n  // 수정 기능은 추후 구현\n  alert('수정 기능은 현재 준비 중입니다')\n}\n\nasync function handleUpdateComment(commentId: number) {\n  if (!editingCommentContent.value.trim()) return\n\n  const { error: updateError } = await updateComment(commentId, editingCommentContent.value)\n\n  if (updateError) {\n    alert('댓글 수정에 실패했습니다: ' + updateError)\n  } else {\n    cancelEditComment()\n  }\n}\n\nasync function handleDeleteComment(commentId: number) {\n  if (!confirm('댓글을 삭제하시겠습니까?')) return\n\n  const { error: deleteError } = await deleteComment(commentId)\n\n  if (deleteError) {\n    alert('댓글 삭제에 실패했습니다: ' + deleteError)\n  } else {\n    // After deleting a comment, reload all comments to ensure the threaded structure is updated\n    await loadComments()\n  }\n}\n\nasync function handleDelete() {\n  if (!confirm('건의사항을 삭제하시겠습니까?')) return\n\n  const { error: deleteError } = await deleteSuggestion(suggestionId)\n\n  if (deleteError) {\n    alert('삭제에 실패했습니다: ' + deleteError)\n  } else {\n    router.push('/suggestions')\n  }\n}\n\nfunction formatDate(dateString: string) {\n  const date = new Date(dateString)\n  return date.toLocaleDateString('ko-KR', {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit'\n  })\n}\n</script>\n"],"names":["_ssrRenderAttrs","_mergeProps","_ssrInterpolate","_push","_parent","_unref","_ssrRenderList"],"mappings":"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"}